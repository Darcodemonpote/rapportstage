"use strict";(self.webpackChunkmon_wiki=self.webpackChunkmon_wiki||[]).push([[1],{7551:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"sujet2-resynchro-prodauto","title":"sujet2-resynchro-prodauto","description":"Contexte","source":"@site/docs/sujet2-resynchro-prodauto.md","sourceDirName":".","slug":"/sujet2-resynchro-prodauto","permalink":"/rapportstage/sujet2-resynchro-prodauto","draft":false,"unlisted":false,"editUrl":"https://github.com/Darcodemonpote/rapportstage/edit/main/docs/sujet2-resynchro-prodauto.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"sujet1-talend-dates","permalink":"/rapportstage/sujet1-talend-dates"},"next":{"title":"sujet3-resynchro-tpo2mrh","permalink":"/rapportstage/sujet3-resynchro-tpo2mrh"}}');var s=t(4848),a=t(8453);const o={},c=void 0,i={},d=[{value:"Contexte",id:"contexte",level:3},{value:"Objectif",id:"objectif",level:3},{value:"Contraintes techniques",id:"contraintes-techniques",level:3},{value:"Requ\xeate SQL d\u2019exemple /A EXPLIQUER\\",id:"requ\xeate-sql-dexemple-a-expliquer",level:3}];function l(e){const n={code:"code",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h3,{id:"contexte",children:"Contexte"}),"\n",(0,s.jsxs)(n.p,{children:["Dans le cadre de la mise en place de la norme RGPD, il y a eu la mise en place d'une purge sur la base de donn\xe9e contenant les contrats/devis ajout\xe9s par les utilisateurs (DB2), or la base de donn\xe9e du datahub n'a pas subis ces memes mises \xe0 jours, et donc les donn\xe9es n'avaient pas \xe9t\xe9 purg\xe9s de ce cot\xe9.\r\nLe composant li\xe9 aux contrats et devis automobile (",(0,s.jsx)(n.strong,{children:"prodauto"}),") fait partie des composants aff\xe9ct\xe9s par cela."]}),"\n",(0,s.jsxs)(n.p,{children:["Pour assurer la bonne ",(0,s.jsx)(n.strong,{children:"conformit\xe9"})," avec les exigences RGPD, il faut donc ",(0,s.jsx)(n.strong,{children:"resynchroniser"})," ces donn\xe9es supprim\xe9es en les r\xe9int\xe9grant dans le processus de purge, afin qu\u2019elles soient correctement prises en compte."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"objectif",children:"Objectif"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"R\xe9cuperer et ing\xe9rer /A EXPLIQUER\\ un Unload de la base DB2 qui correspont aux donn\xe9es n'ayant pas \xe9t\xe9 purg\xe9s."}),"\n",(0,s.jsxs)(n.li,{children:["G\xe9n\xe9rer un fichier ",(0,s.jsx)(n.strong,{children:"delta"})," qui identifie les donn\xe9es absentes ou non trait\xe9es dans la base actuelle, pour une purge compl\xe8te et fiable."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"contraintes-techniques",children:"Contraintes techniques"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"R\xe9utilisation d'identifiants pour les 3 tables de prodauto (table des contrats, contrats \xe0 effet diff\xe9r\xe9 et devis)"}),"\n",(0,s.jsxs)(n.li,{children:["La manipulation repose sur des ",(0,s.jsx)(n.strong,{children:"requ\xeates SQL"})," avec des jointures et des fonctions analytiques."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"requ\xeate-sql-dexemple-a-expliquer",children:"Requ\xeate SQL d\u2019exemple /A EXPLIQUER\\"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT 'contrat' AS ctymet,\r\n       t3.nsc AS nsc,\r\n       t3.ncnt AS ncnt,\r\n       CONCAT('31/12/', CAST(CAST(SUBSTR(t3.base_timestamp,1,4) AS INT) - 1 AS STRING)) AS dpasarch,\r\n       '' AS dapurge,\r\n       DATE_FORMAT(CURRENT_TIMESTAMP,'yyyy-MM-dd HH:mm:ss') AS date_ingestion\r\nFROM (\r\n    SELECT t2.nsc,\r\n           t2.ncnt,\r\n           t2.min_dnrdef,\r\n           t2.max_dnrdef,\r\n           t2.base_timestamp,\r\n           ROW_NUMBER() OVER (PARTITION BY t2.nsc, t2.ncnt ORDER BY t2.base_timestamp ASC) AS rn\r\n    FROM (\r\n        SELECT j.nsc,\r\n               j.ncnt,\r\n               MIN(j.dnrdef) OVER (PARTITION BY j.nsc, j.ncnt) AS min_dnrdef,\r\n               MAX(j.dnrdef) OVER (PARTITION BY j.nsc, j.ncnt) AS max_dnrdef,\r\n               MAX(n.dtl__capxtimestamp) OVER (PARTITION BY j.nsc, j.ncnt) AS base_timestamp\r\n        FROM metcdc_tpacon10_histo j\r\n        INNER JOIN resynchro_tpacon10 n ON j.nsc = n.nsc AND j.ncnt = n.ncnt\r\n    ) AS t2\r\n    WHERE ADD_MONTHS(t2.min_dnrdef, ${delay_reuse}) < t2.max_dnrdef\r\n) AS t3\r\nWHERE t3.rn = 1\r\nUNION ALL\r\nSELECT 'contrat' AS ctymet,\r\n       b.nsc AS nsc,\r\n       b.ncnt AS ncnt,\r\n       CAST('${date_arch}' AS STRING) AS dpasarch,\r\n       '' AS dapurge,\r\n       DATE_FORMAT(CURRENT_TIMESTAMP,'yyyy-MM-dd HH:mm:ss') AS date_ingestion\r\nFROM metcdc_tpacon10_base b\r\nWHERE NOT EXISTS (\r\n    SELECT 1\r\n    FROM resynchro_tpacon10 i\r\n    WHERE b.nsc = i.nsc AND b.ncnt = i.ncnt\r\n);\n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var r=t(6540);const s={},a=r.createContext(s);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);